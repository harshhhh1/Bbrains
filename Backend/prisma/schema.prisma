generator client {
  provider        = "prisma-client-js"
  previewFeatures = ["views"]
}

datasource db {
  provider = "postgresql"
}

model College {
  id        Int      @id @default(autoincrement()) @map("college_id")
  name      String   @db.VarChar(50)
  addressId Int?     @map("address_id")
  email     String   @db.VarChar(50)
  regNo     String   @map("reg_no") @db.VarChar(50)
  createdAt DateTime @default(now())
  address   Address? @relation(fields: [addressId], references: [id])
  users     User[]

  @@map("college")
}

model User {
  id               String               @id @default(uuid()) @map("user_id")
  collegeId        Int                  @map("college_id")
  email            String               @unique @db.VarChar(50)
  username         String               @unique @db.VarChar(32)
  password         String               @db.VarChar(255)
  type             UserRole             @default(student)
  createdAt        DateTime             @default(now()) @map("created_at")
  updatedAt        DateTime             @updatedAt @map("updated_at")
  addresses        Address[]
  announcements    Announcement[]
  auditLogs        AuditLog[]
  cartItems        Cart[]
  enrollments      Enrollment[]
  grades           Grade[]
  leaderboards     Leaderboard[]
  orders           Order[]
  products         Product[]
  submissions      Submission[]
  transactions     TransactionHistory[]
  college          College              @relation(fields: [collegeId], references: [id])
  userAchievements UserAchievements[]
  userDetails      UserDetails?
  roles            UserRoles[]
  wallet           Wallet?
  xp               Xp?

  @@map("user")
}

model UserDetails {
  id         Int      @id @default(autoincrement())
  userId     String   @unique @map("user_id")
  avatar     String?
  firstName  String   @map("first_name") @db.VarChar(25)
  middlename String?
  lastName   String   @map("last_name") @db.VarChar(25)
  sex        Sex
  dob        DateTime @db.Date
  phone      String?  @db.VarChar(15)
  addressId  Int?     @map("address_id")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")
  address    Address? @relation(fields: [addressId], references: [id])
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("user_details")
}

model Address {
  id           Int           @id @default(autoincrement())
  userId       String?       @map("user_id")
  addressLine1 String        @map("address_line1") @db.VarChar(255)
  addressLine2 String?       @map("address_line2") @db.VarChar(255)
  city         String        @db.VarChar(50)
  state        String?       @db.VarChar(100)
  postalCode   String?       @map("postal_code") @db.VarChar(10)
  country      String        @db.VarChar(100)
  user         User?         @relation(fields: [userId], references: [id], onDelete: Cascade)
  colleges     College[]
  userDetails  UserDetails[]

  @@map("address")
}

model Course {
  id          Int          @id @default(autoincrement()) @map("course_id")
  name        String       @db.VarChar(100)
  description String?      @db.VarChar(255)
  assignments Assignment[]
  enrollments Enrollment[]

  @@map("course")
}

model Enrollment {
  userId     String   @map("user_id")
  courseId   Int      @map("course_id")
  enrolledAt DateTime @default(now()) @map("enrolled_at")
  grade      String?  @db.VarChar(5)
  course     Course   @relation(fields: [courseId], references: [id])
  user       User     @relation(fields: [userId], references: [id])

  @@id([userId, courseId])
  @@index([courseId])
  @@map("enrollment")
}

model Assignment {
  id          Int          @id @default(autoincrement()) @map("assignment_id")
  courseId    Int          @map("course_id")
  title       String       @db.VarChar(100)
  description String?      @db.VarChar(255)
  content     String?
  file        String?
  dueDate     DateTime     @map("due_date") @db.Date
  createdAt   DateTime     @default(now()) @map("created_at")
  updatedAt   DateTime     @updatedAt @map("updated_at")
  course      Course       @relation(fields: [courseId], references: [id])
  grades      Grade[]
  submissions Submission[]

  @@map("assignment")
}

model Submission {
  id           Int        @id @default(autoincrement()) @map("submission_id")
  assignmentId Int        @map("assignment_id")
  userId       String     @map("user_id")
  filePath     String     @map("file_path") @db.VarChar(255)
  submittedAt  DateTime   @default(now()) @map("submitted_at")
  assignment   Assignment @relation(fields: [assignmentId], references: [id])
  user         User       @relation(fields: [userId], references: [id])

  @@index([assignmentId])
  @@index([userId])
  @@map("submission")
}

model Grade {
  id           Int        @id @default(autoincrement())
  userId       String     @map("user_id")
  assignmentId Int        @map("assignment_id")
  grade        String     @db.VarChar(5)
  gradedAt     DateTime   @default(now()) @map("graded_at")
  gradedBy     String     @map("checked_by") @db.VarChar(50)
  assignment   Assignment @relation(fields: [assignmentId], references: [id])
  user         User       @relation(fields: [userId], references: [id])

  @@index([assignmentId])
  @@index([userId])
  @@map("grade")
}

model Role {
  id          Int         @id @default(autoincrement()) @map("role_id")
  name        String      @unique @db.VarChar(50)
  description String?     @db.VarChar(255)
  users       UserRoles[]

  @@map("role")
}

model UserRoles {
  userId     String   @map("user_id")
  roleId     Int      @map("role_id")
  assignedAt DateTime @default(now()) @map("assigned_at")
  role       Role     @relation(fields: [roleId], references: [id], onDelete: Cascade)
  user       User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@map("user_roles")
}

model Xp {
  id        Int      @id @default(autoincrement())
  userId    String   @unique @map("user_id")
  xp        Decimal  @default(0)
  level     Int      @default(1)
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("xp")
}

model Level {
  id          Int     @id @default(autoincrement())
  levelNumber Int     @unique
  requiredXp  Decimal @db.Decimal(10, 2)

  @@map("level")
}

model Leaderboard {
  id          Int                 @id @default(autoincrement())
  userId      String              @map("user_id")
  score       Decimal             @db.Decimal(10, 2)
  category    LeaderboardCategory @default(allTime)
  periodStart DateTime
  periodEnd   DateTime?
  rank        Int?
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")
  user        User                @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category, periodStart])
  @@index([category, score(sort: Desc)])
  @@map("leaderboard")
}

model Achievement {
  id          Int                @id @default(autoincrement()) @map("achivement_id")
  name        String             @db.VarChar(100)
  description String?            @db.VarChar(255)
  icon        String?
  requiredXp  Decimal            @db.Decimal(10, 2)
  category    String?            @db.VarChar(50)
  users       UserAchievements[]

  @@map("achievement")
}

model UserAchievements {
  userId        String      @map("user_id")
  achievementId Int         @map("achievement_id")
  unlockedAt    DateTime    @default(now()) @map("unlocked_at")
  achievement   Achievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)
  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([userId, achievementId])
  @@map("user_achievements")
}

model Wallet {
  id      Int     @id @default(autoincrement()) @map("wallet_id")
  userId  String  @unique @map("user_id")
  pin     String? @db.VarChar(255)
  balance Decimal @default(500.00) @db.Decimal(10, 2)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("wallet")
}

model Product {
  id          Int         @id @default(autoincrement()) @map("product_id")
  creatorId   String      @map("creator_id")
  name        String      @db.VarChar(100)
  description String?     @db.VarChar(255)
  image       String?     @db.VarChar(255)
  price       Decimal     @db.Decimal(10, 2)
  stock       Int
  createdAt   DateTime    @default(now()) @map("created_at")
  cartItems   Cart[]
  orderItems  OrderItem[]
  creator     User        @relation(fields: [creatorId], references: [id], onDelete: Cascade)

  @@index([name])
  @@map("product")
}

model Order {
  id          Int         @id @default(autoincrement()) @map("order_id")
  userId      String      @map("user_id")
  status      String?     @default("pending")
  orderDate   DateTime    @default(now()) @map("order_date")
  totalAmount Decimal     @map("total_amount") @db.Decimal(10, 2)
  user        User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  items       OrderItem[]

  @@index([userId])
  @@map("order")
}

model OrderItem {
  id        Int     @id @default(autoincrement())
  orderId   Int     @map("order_id")
  productId Int     @map("product_id")
  quantity  Int
  price     Decimal @db.Decimal(10, 2)
  order     Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)
  product   Product @relation(fields: [productId], references: [id])

  @@map("order_item")
}

model TransactionHistory {
  id              Int               @id @default(autoincrement())
  userId          String            @map("user_id")
  transactionDate DateTime          @default(now()) @map("transaction_date")
  amount          Decimal           @db.Decimal(10, 2)
  type            TransactionType
  status          TransactionStatus @default(pending)
  note            String?           @db.VarChar(255)
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, transactionDate(sort: Desc)])
  @@map("transaction_history")
}

model Cart {
  id        Int     @id @default(autoincrement())
  userId    String  @map("user_id")
  productId Int     @map("product_id")
  quantity  Int
  price     Decimal @db.Decimal(10, 2)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  user      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, productId])
  @@map("cart")
}

model Announcement {
  id          Int      @id @default(autoincrement())
  userId      String   @map("user_id")
  title       String   @db.VarChar(100)
  description String?
  image       String?
  createdAt   DateTime @default(now()) @map("created_at")
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("announcement")
}

model AuditLog {
  id        Int         @id @default(autoincrement())
  userId    String      @map("user_id")
  category  LogCategory
  action    String
  entity    String
  entityId  String
  change    Json?
  reason    String?
  createdAt DateTime    @default(now()) @map("created_at")
  user      User        @relation(fields: [userId], references: [id])

  @@index([category])
  @@index([userId])
  @@map("audit_log")
}

enum Sex {
  male
  female
  other
}

enum UserRole {
  student
  teacher
  admin
  staff
}

enum TransactionType {
  credit
  debit
}

enum TransactionStatus {
  success
  failed
  pending
}

enum LeaderboardCategory {
  weekly
  monthly
  allTime
  course
}

enum LogCategory {
  AUTH
  ACADEMIC
  MARKET
  FINANCE
  USER
  SYSTEM
}
